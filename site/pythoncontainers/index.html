
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.1, mkdocs-material-1.2.0">
    
    
      
        <title>Python benchmarks - My Docs</title>
      
    
    
      <script src="../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-e17eeafcbc.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
      <link rel="stylesheet" href="../font_awesome/css/font-awesome.min.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="My Docs" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Python benchmarks
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Python benchmarks
      </label>
    
    <a href="./" title="Python benchmarks" class="md-nav__link md-nav__link--active">
      Python benchmarks
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#testing-python-inside-containers" title="Testing python inside containers" class="md-nav__link">
    Testing python inside containers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wallclock-results" title="Wallclock Results" class="md-nav__link">
    Wallclock Results
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#processor-type-xeon-e5-2683-v4" title="Processor type: Xeon E5-2683 v4" class="md-nav__link">
    Processor type: Xeon E5-2683 v4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processor-type-amd-opteron-6712" title="Processor type: AMD Opteron 6712" class="md-nav__link">
    Processor type: AMD Opteron 6712
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processor-type-xeon-e5645" title="Processor type: Xeon E5645" class="md-nav__link">
    Processor type: Xeon E5645
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-files" title="Data files" class="md-nav__link">
    Data files
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#testing-python-inside-containers" title="Testing python inside containers" class="md-nav__link">
    Testing python inside containers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wallclock-results" title="Wallclock Results" class="md-nav__link">
    Wallclock Results
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#processor-type-xeon-e5-2683-v4" title="Processor type: Xeon E5-2683 v4" class="md-nav__link">
    Processor type: Xeon E5-2683 v4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processor-type-amd-opteron-6712" title="Processor type: AMD Opteron 6712" class="md-nav__link">
    Processor type: AMD Opteron 6712
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processor-type-xeon-e5645" title="Processor type: Xeon E5645" class="md-nav__link">
    Processor type: Xeon E5645
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-files" title="Data files" class="md-nav__link">
    Data files
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
              
                
                <h1 id="benchmarking-python-with-singularity-containers">Benchmarking python with singularity containers</h1>
<p><a href="http://singularity.lbl.gov/">Singularity</a> is a container solution designed for HPC.
Due to the secure and simple design, it can be easily used to provide
applications for use with HPC clusters where other containers, such as Docker
would not be suitable.</p>
<h2 id="testing-python-inside-containers">Testing python inside containers</h2>
<p>Linux containers offer a great way to compare software performance on a production system without installing extra packages on your shared filesystem.</p>
<p>After early tests on 3 different node type using python 2.7.8 on CentOS6 containers showed SCL python running the same code between 16-25% more slowly than a self-compiled python 2.7.8 running natively, further tests were performed, instead with CentOS 7.</p>
<p>A single-core python job to find <a href="https://github.com/sbutcher/python_test/blob/master/python_prime2.py">primes of a large number</a> was run natively on a compute node via the Univa Grid Engine job scheduler. The job was then repeated on the same node inside a container running the same version of python compiled with gcc, and also a packaged python provided by the CentOS <a href="https://wiki.centos.org/AdditionalResources/Repositories/SCL">Software Collections Library</a>. The SCL is marketed as a simple way to get multiple versions of python on your enterprise OS without having to compile new versions. Jobs were run using CentOS 7.3 and python 2.7.13 supplied in the following ways:</p>
<ul>
<li>(A) Native OS</li>
<li>(B) Singularity container, python compiled from source</li>
<li>(C) Singularity container, python compiled from source, configured with --enable-optimizations flag</li>
<li>(D) Singularity container, python supplied via  CentOS SCL</li>
</ul>
<p>Where python was compiled, the same gcc version 4.8.5 was used. Tasks A and B can be compared directly to establish if there is any performance impact on using containers vs native OS.</p>
<h3 id="wallclock-results">Wallclock Results</h3>
<p>The following statistics were averaged over multiple runs using the Grid Engine <code>qacct</code> command, and rounded to the nearest whole number for readability. The total wallclock time is reported by the job scheduler, and includes any overheads a container may introduce, such as time to load a container file.</p>
<h4 id="processor-type-xeon-e5-2683-v4">Processor type: Xeon E5-2683 v4</h4>
<table>
<thead>
<tr>
<th>Task</th>
<th align="right">cpusecs</th>
<th align="right">ioops</th>
<th align="right">RAM/MB</th>
</tr>
</thead>
<tbody>
<tr>
<td>Native</td>
<td align="right">4731</td>
<td align="right">3751</td>
<td align="right">566</td>
</tr>
<tr>
<td>Container</td>
<td align="right">4723</td>
<td align="right">3943</td>
<td align="right">565</td>
</tr>
<tr>
<td>Container,<br/> enable-optimisations</td>
<td align="right">9892</td>
<td align="right">3937</td>
<td align="right">1184</td>
</tr>
<tr>
<td>Container, SCL</td>
<td align="right">5604</td>
<td align="right">3976</td>
<td align="right">681</td>
</tr>
</tbody>
</table>
<p><img alt="nxv chart" src="../nxv.png" /></p>
<h4 id="processor-type-amd-opteron-6712">Processor type: AMD Opteron 6712</h4>
<table>
<thead>
<tr>
<th>Task</th>
<th align="right">cpusecs</th>
<th align="right">ioops</th>
<th align="right">mem/MB</th>
</tr>
</thead>
<tbody>
<tr>
<td>Native</td>
<td align="right">9687</td>
<td align="right">3975</td>
<td align="right">1160</td>
</tr>
<tr>
<td>Container</td>
<td align="right">9667</td>
<td align="right">4166</td>
<td align="right">1158</td>
</tr>
<tr>
<td>Container,<br/> enable-optimisations</td>
<td align="right">23478</td>
<td align="right">4155</td>
<td align="right">2810</td>
</tr>
<tr>
<td>Container, SCL</td>
<td align="right">11813</td>
<td align="right">4229</td>
<td align="right">1436</td>
</tr>
</tbody>
</table>
<p><img alt="ccn chart" src="../ccn.png" /></p>
<h4 id="processor-type-xeon-e5645">Processor type: Xeon E5645</h4>
<table>
<thead>
<tr>
<th>Task</th>
<th align="right">cpusecs</th>
<th align="right">ioops</th>
<th align="right">mem/MB</th>
</tr>
</thead>
<tbody>
<tr>
<td>Native</td>
<td align="right">6186</td>
<td align="right">3373</td>
<td align="right">741</td>
</tr>
<tr>
<td>Container</td>
<td align="right">6305</td>
<td align="right">3569</td>
<td align="right">754</td>
</tr>
<tr>
<td>Container,<br/> enable-optimisations</td>
<td align="right">15237</td>
<td align="right">3573</td>
<td align="right">1824</td>
</tr>
<tr>
<td>Container, SCL</td>
<td align="right">7722</td>
<td align="right">3634</td>
<td align="right">938</td>
</tr>
</tbody>
</table>
<p><img alt="dn chart" src="../dn.png" /></p>
<h2 id="summary">Summary</h2>
<p>It can be observed from the results that there is only a marginal difference of less than 2% between native and containerised python when installed from source. Therefore, tje container does not signicantly affect performance. In fact, the python container was sometimes a few seconds faster. This value is the total wallclock time reported by the job scheduler, and includes the time taken to load the container file.</p>
<p>The SCL python runs consistently slower than the compiled python on all nodes types, suggesting that, although convenient, may not be suitable for HPC environments.</p>
<p>The python compiled with <code>--enable-optimizations</code> performed very poorly, and should be a lesson to system administrators not to blindly follow suggestions without testing. Quite why it performed so badly requires further investigation.</p>
<p>Containers provide an excellent way to provision tricky applications, particularly in the Bioinformatics and Deep-learning disciplines, but additionally provide a safe and easy way to gain performance improvements and new features offered by the latest and greatest versions of common applications, while offering an easy way to compare different configuration and compilation options that, as we have seen, could have significant impact on performance, which is critical in an HPC environment.</p>
<h2 id="data-files">Data files</h2>
<p>The Singularity definition files used for these tests can be found on <a href="https://github.com/sbutcher/python_test">Github</a>.</p>
              
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../about/" title="About" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                About
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-30ac6a1727.js"></script>
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>